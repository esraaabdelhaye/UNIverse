<div class="container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <span class="material-symbols-outlined logo-icon">school</span>
      <h2 class="logo-text">UNIverse</h2>
    </div>
    <nav class="nav">
      <a
        class="nav-link"
        routerLink="/doctor-dashboard"
        routerLinkActive="active"
        [routerLinkActiveOptions]="{ exact: true }"
      >
        <span class="material-symbols-outlined">dashboard</span>
        <span>Dashboard</span>
      </a>
      <a class="nav-link" routerLink="/doctor-dashboard/upload-material" routerLinkActive="active">
        <span class="material-symbols-outlined">upload_file</span>
        <span>Upload Material</span>
      </a>
      <a class="nav-link" routerLink="/doctor-dashboard/course-students" routerLinkActive="active">
        <span class="material-symbols-outlined">group</span>
        <span>Course Students</span>
      </a>
      <a class="nav-link" routerLink="/doctor-dashboard/view-submissions" routerLinkActive="active">
        <span class="material-symbols-outlined">assignment</span>
        <span>View Submissions</span>
      </a>
      <a
        class="nav-link active"
        routerLink="/doctor-dashboard/course-announcements"
        routerLinkActive="active"
      >
        <span class="material-symbols-outlined">campaign</span>
        <span>Announcements</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a class="nav-link logout-link" (click)="logout()" href="javascript:void(0)">
        <span class="material-symbols-outlined">logout</span>
        <span>Log Out</span>
      </a>
    </div>
  </aside>

  <div class="main-wrapper">
    <header class="header">
      <div class="header-actions">
        <button class="icon-button">
          <span class="material-symbols-outlined">notifications</span>
          <span class="notification-badge"></span>
        </button>
        <img class="user-avatar" src="../../../../assets/user.png" alt="User" />
        <div class="user-info">
          <p class="user-name">{{ currentDoctor.fullName }}</p>
          <p class="user-role">{{ currentDoctor.role }}</p>
        </div>
      </div>
    </header>

    <main class="main-content">
      <div class="content-wrapper">
        <div class="page-header">
          <h1 class="page-title">Announcements</h1>
          <p class="page-subtitle">Manage course announcements</p>
        </div>

        <!-- Create Announcement -->
        <div class="card create-announcement">
          <h3 class="card-title">Create Announcement</h3>

          <div class="form-group">
            <label class="form-label">Select Course *</label>
            <select class="form-select" [(ngModel)]="selectedCourse">
              <option value="">Choose a course</option>
              <option *ngFor="let course of courses" [value]="course.courseCode">
                {{ course.courseCode }}: {{ course.courseTitle }}
              </option>
            </select>
          </div>

          <div class="form-group">
            <label class="form-label">Title *</label>
            <input
              class="form-input"
              type="text"
              [(ngModel)]="newTitle"
              placeholder="Announcement title"
            />
          </div>

          <div class="form-group">
            <label class="form-label">Message *</label>
            <textarea
              class="form-textarea"
              rows="4"
              [(ngModel)]="newMessage"
              placeholder="Write your announcement..."
            ></textarea>
          </div>

          <div class="form-actions">
            <!-- <button class="btn btn-secondary" (click)="saveDraft()" type="button">
              Save Draft
            </button> -->
            @if(!isEditing){
            <button
              class="btn btn-primary"
              (click)="publishAnnouncement()"
              [disabled]="isPublishing"
              type="button"
            >
              <span class="material-symbols-outlined" *ngIf="!isPublishing">send</span>
              {{ isPublishing ? 'Publishing...' : 'Publish' }}
            </button>
            } @else{
            <button
              class="btn btn-primary"
              (click)="updateAnnouncement()"
              [disabled]="isUpdating"
              type="button"
            >
              <span class="material-symbols-outlined" *ngIf="!isUpdating">update</span>
              {{ isUpdating ? 'Updating...' : 'Update' }}
            </button>
            }
          </div>
        </div>

        <!-- Announcements List -->
        <div class="card">
          <h3 class="card-title">Recent Announcements</h3>

          <div class="announcement-list">
            <div class="announcement-item" *ngFor="let announcement of announcements">
              <div class="announcement-header">
                <div>
                  <h4 class="announcement-title">{{ announcement.title }}</h4>
                  <span class="announcement-course">{{ announcement.courseCode }}</span>
                </div>
                <span class="badge" [ngClass]="'badge-' + announcement.status">
                  {{ announcement.status | titlecase }}
                </span>
              </div>

              <p class="announcement-text">{{ announcement.content }}</p>

              <div class="announcement-meta">
                <span class="announcement-date">{{ announcement.createdDate }}</span>
              </div>

              <div class="announcement-actions">
                <button
                  class="btn-small btn-edit"
                  (click)="editAnnouncement(announcement)"
                  type="button"
                >
                  Edit
                </button>
                <button
                  class="btn-small btn-delete"
                  (click)="deleteAnnouncement(announcement)"
                  type="button"
                >
                  Delete
                </button>
                <button
                  class="btn-small btn-publish"
                  (click)="publishDraft(announcement)"
                  *ngIf="announcement.status === 'draft'"
                  type="button"
                >
                  Publish
                </button>
              </div>
            </div>
          </div>

          <div class="no-announcements" *ngIf="announcements.length === 0">
            <p>No announcements yet</p>
          </div>
        </div>
      </div>
    </main>
  </div>
</div>
