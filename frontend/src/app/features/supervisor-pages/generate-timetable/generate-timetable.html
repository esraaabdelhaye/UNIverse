<div class="container">
  <aside class="sidebar">
    <div class="sidebar-header">
      <span class="material-symbols-outlined logo-icon">school</span>
      <h2 class="logo-text">UNIverse</h2>
    </div>
    <nav class="nav">
      <a class="nav-link active" routerLink="/supervisor-dashboard" routerLinkActive="active"
        [routerLinkActiveOptions]="{exact: true}">
        <span class="material-symbols-outlined">dashboard</span>
        <span>Dashboard</span>
      </a>
      <a class="nav-link" routerLink="/supervisor-dashboard/course-availability" routerLinkActive="active">
        <span class="material-symbols-outlined">event_available</span>
        <span>Course Availability</span>
      </a>
      <a class="nav-link" routerLink="/supervisor-dashboard/generate-timetable" routerLinkActive="active">
        <span class="material-symbols-outlined">calendar_month</span>
        <span>Generate Timetable</span>
      </a>
      <a class="nav-link" routerLink="/supervisor-dashboard/manage-faculty" routerLinkActive="active">
        <span class="material-symbols-outlined">groups</span>
        <span>Manage Faculty</span>
      </a>
    </nav>
    <div class="sidebar-footer">
      <a class="nav-link" href="javascript:void(0)" (click)="logout()"><span
          class="material-symbols-outlined">logout</span><span>Logout</span></a>
    </div>
  </aside>
  <div class="main-wrapper">
    <header class="header">
      <div class="header-actions">
        <button class="notification-btn">
          <span class="material-symbols-outlined">notifications</span>
          <span class="notification-badge"></span>
        </button>
        <div class="user-avatar"
          style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAoY4Wp7qmxX4VDSoT3Vmr2qswqkkPQKnfXBi6UrbCvHMkyQzCjFcbZlORsU-j2DvMuJNYOaqwfZcgTjF_Hg8IDEtySTCcfrtyWohPVSbGWzk_oW6GXLl0Hz6W9aDh3lqrBKeUzDWnMUPNGhawW9SNYnA9mf23sryoHadAYDjt2nOqgr2sbWDfD66OJ8Z0EzkvZS8SELiYlOJitGiAXsYPceto35Ief5jqo9WsQb0JhLm_z4eaJE5XPe2C6hgQEr3qw0BVsIWoEIHM");'>
        </div>
        <div class="user-info">
          <p class="user-name">Alex Hartman</p>
          <p class="user-role">Supervisor</p>
        </div>
      </div>
    </header>
    <main class="main-content">
      <div class="timetable-grid">
        <div class="constraints-panel">
          <div class="card">
            <h2 class="card-title">
              <span class="material-symbols-outlined">tune</span> Schedule Constraints
            </h2>
            <p class="subtitle">Select courses and optional room preferences for generation.</p>

            <!-- Academic Year -->
            <div class="form-group" style="margin-top: 16px;">
              <label>Academic Year</label>
              <select [(ngModel)]="selectedAcademicYear" (change)="onYearChange()" class="form-control">
                <option *ngFor="let year of academicYears" [value]="year">{{ year }}</option>
              </select>
            </div>

            <!-- Semester -->
            <div class="form-group" style="margin-top: 12px;">
              <label>Semester</label>
              <select [(ngModel)]="selectedSemester" (change)="onSemesterChange()" class="form-control">
                <option *ngFor="let semester of semesters" [value]="semester">{{ semester }}</option>
              </select>
            </div>

            <!-- Constraint Form -->
            <div class="constraint-form"
              style="margin-top: 16px; border: 1px solid #E2E8F0; padding: 16px; border-radius: 8px; background: #F8FAFC;">
              <h3 style="font-size: 14px; margin-bottom: 12px;">Add Course to Schedule</h3>

              <div class="form-group">
                <label>Course</label>
                <select [(ngModel)]="newConstraint.courseId" class="form-control">
                  <option [ngValue]="null">Select Course...</option>
                  <option *ngFor="let c of availableCourses" [value]="c.id">{{ c.courseCode }} - {{ c.name }}</option>
                </select>
              </div>

              <div class="form-group">
                <label>Preferred Room (Optional)</label>
                <select [(ngModel)]="newConstraint.room" class="form-control">
                  <option value="">Any (Auto-assign)</option>
                  <option value="Room 101">Room 101</option>
                  <option value="Room 102">Room 102</option>
                  <option value="Lab 1">Lab 1</option>
                  <option value="Hall A">Hall A</option>
                </select>
              </div>

              <div class="action-bar" style="margin-top: 16px;">
                <button class="btn-primary" (click)="addConstraint()" [disabled]="!newConstraint.courseId">
                  <span class="material-symbols-outlined">add</span>
                  <span>Add to List</span>
                </button>
              </div>
            </div>

            <div class="table-wrapper" style="max-height: 400px; overflow-y: auto; margin-top: 24px;">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Code</th>
                    <th>Room Pref</th>
                    <th>Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let c of constraints">
                    <td class="course-code">{{ c.code }}</td>
                    <td>{{ c.room }}</td>
                    <td>
                      <button class="icon-btn danger" (click)="removeConstraint(c)">
                        <span class="material-symbols-outlined">delete</span>
                      </button>
                    </td>
                  </tr>
                  <tr *ngIf="constraints.length === 0">
                    <td colspan="3" style="text-align: center; color: #64748B; padding: 20px;">
                      No courses selected. Add courses above.
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>

            <button class="btn-primary" (click)="generateTimetable()"
              style="width: 100%; margin-top: 24px; justify-content: center;"
              [disabled]="isLoading || constraints.length === 0">
              <span class="material-symbols-outlined" *ngIf="!isLoading">auto_awesome</span>
              <span class="spinner" *ngIf="isLoading"></span>
              <span>{{ isLoading ? 'Generating...' : 'Generate Timetable' }}</span>
            </button>
          </div>
        </div>
        <div class="timetable-view">
          <div class="card">
            <div class="timetable-header">
              <h2 class="card-title">
                <span class="material-symbols-outlined">grid_view</span> Timetable ( {{ selectedSemester }} {{selectedYear }} - {{selectedAcademicYear }} )
              </h2>
              <div class="timetable-actions">
                <button class="btn-secondary" (click)="downloadTimetable()" *ngIf="isGenerated">
                  <span class="material-symbols-outlined">download</span>
                  <span>Download</span>
                </button>
              </div>
            </div>

            <div class="empty-state" *ngIf="!isGenerated">
              <span class="material-symbols-outlined" style="font-size: 48px; color: #CBD5E1;">calendar_today</span>
              <p>Add constraints and generate to view timetable.</p>
            </div>

            <div class="table-wrapper" *ngIf="isGenerated">
              <table class="timetable-table">
                <thead>
                  <tr>
                    <th class="time-cell">Time</th>
                    <th>Saturday</th>
                    <th>Sunday</th>
                    <th>Monday</th>
                    <th>Tuesday</th>
                    <th>Wednesday</th>
                    <th>Thursday</th>
                  </tr>
                </thead>
                <tbody>
                  <tr *ngFor="let slot of generatedGrid">
                    <td class="time-cell">{{ slot.time }}</td>
                    <td [class.clickable]="slot.saturday && slot.saturday.length > 0">
                      <div *ngFor="let course of slot.saturday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                    <td [class.clickable]="slot.sunday && slot.sunday.length > 0">
                      <div *ngFor="let course of slot.sunday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                    <td [class.clickable]="slot.monday && slot.monday.length > 0">
                      <div *ngFor="let course of slot.monday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                    <td [class.clickable]="slot.tuesday && slot.tuesday.length > 0">
                      <div *ngFor="let course of slot.tuesday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                    <td [class.clickable]="slot.wednesday && slot.wednesday.length > 0">
                      <div *ngFor="let course of slot.wednesday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                    <td [class.clickable]="slot.thursday && slot.thursday.length > 0">
                      <div *ngFor="let course of slot.thursday" (click)="onCellClick(course)"
                        [ngClass]="'class-slot ' + course.type" style="margin-bottom: 4px;">
                        <p class="class-title">{{ course.courseCode }}</p>
                        <p class="class-details">{{ course.instructor }} / {{ course.room }}</p>
                      </div>
                    </td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </main>
  </div>

  <!-- Edit Modal -->
  <div class="modal-overlay" *ngIf="isEditModalOpen" (click)="closeEditModal()">
    <div class="modal-content" (click)="$event.stopPropagation()">
      <div class="modal-header">
        <h3>Edit Schedule Slot</h3>
        <button class="close-btn" (click)="closeEditModal()">
          <span class="material-symbols-outlined">close</span>
        </button>
      </div>
      <div class="modal-body" *ngIf="selectedSlot">
        <p><strong>Course:</strong> {{ selectedSlot.courseCode }} - {{ selectedSlot.title }}</p>

        <div class="form-group">
          <label>Day</label>
          <select [(ngModel)]="editForm.dayOfWeek">
            <option>Saturday</option>
            <option>Sunday</option>
            <option>Monday</option>
            <option>Tuesday</option>
            <option>Wednesday</option>
            <option>Thursday</option>
          </select>
        </div>

        <div class="form-group">
          <label>Start Time</label>
          <select [(ngModel)]="editForm.startTime">
            <option *ngFor="let t of timeSlotsList" [value]="t">{{ t }}</option>
          </select>
        </div>

        <div class="form-group">
          <label>Room</label>
          <input type="text" [(ngModel)]="editForm.room" />
        </div>
      </div>
      <div class="modal-footer">
        <button class="icon-btn danger" (click)="deleteSlot()" style="margin-right: auto;">
          <span class="material-symbols-outlined">delete</span> Delete
        </button>
        <button class="btn-secondary" (click)="closeEditModal()">Cancel</button>
        <button class="btn-primary" (click)="updateSlot()">Update</button>
      </div>
    </div>
  </div>

</div>